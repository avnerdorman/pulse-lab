<!DOCTYPE html>
<html>

<head>
    <title>javascript drum machine</title>
    <meta name="description" content="A simple javascript drum machine / drum sequencer built with HTML / CSS and Javascript."
    />
</head>
<link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w"
    crossorigin="anonymous">

<body>
    <link rel="stylesheet" type="text/css" href="main.css" />
    <script
  src="https://code.jquery.com/jquery-3.4.1.slim.js"
  integrity="sha256-BTlTdQO9/fascB1drekrDVkaKd9PkwBymMlHOiG+qLI="
  crossorigin="anonymous"></script>

    <div id="app-message"></div>
    <header class="page-header">
        <h1>Pulses &amp; Drum Tracks Lab</h1>
        <p>Shape Toussaint-style patterns with classic drum kits. Set the grid, tweak the sound, and export your groove instantly.</p>
    </header>
    <div class="app-wrapper">
    <form class="pure-form control-form" id="trackerControls">
        <div id="tracker-container">
            <div id="tracker-controls">
                <div class="control-panel-row">
                    <section class="control-panel primary-panel">
                        <h3>Sound &amp; Pattern</h3>
                        <div class="control-grid compact">
                            <div class="field">
                                <label for="sampleSet">Sample set</label>
                                <select name="sampleSet" class="base" id="sampleSet">
                                    <option value="https://raw.githubusercontent.com/oramics/sampled/master/DM/CR-78/sampled.instrument.json">CR-78</option>
                                    <option value="https://raw.githubusercontent.com/oramics/sampled/master/DM/TR-909/Detroit/sampled.instrument.json">TR-909 Detroit</option>
                                    <option value="https://raw.githubusercontent.com/oramics/sampled/master/DM/TR-909/SP/sampled.instrument.json">TR-909 SP</option>
                                    <option value="https://raw.githubusercontent.com/oramics/sampled/master/DM/MRK-2/sampled.instrument.json">MRK-2</option>
                                    <option value="https://raw.githubusercontent.com/oramics/sampled/master/DM/TR-505/sampled.instrument.json">TR-505</option>
                                    <option value="https://raw.githubusercontent.com/oramics/sampled/master/DM/LM-2/sampled.instrument.json">LM-2</option>
                                    <option value="https://raw.githubusercontent.com/oramics/sampled/master/DRUMS/pearl-master-studio/sampled.instrument.json">Pearl Master Studio</option>
                                </select>
                            </div>
                        </div>
                    </section>

                    <section class="control-panel import-panel">
                        <h3>Pattern Utilities</h3>
                        <p class="panel-hint small">Load a previously exported .txt file or reset to the default hi-hat pulse.</p>
                        <div class="pattern-actions">
                            <button type="button" id="import-pattern-btn">Import .txt</button>
                            <button type="button" id="reset-pattern-btn">Reset to Pulse</button>
                            <button type="button" id="clear-pattern-btn">Clear Grid</button>
                        </div>
                        <input type="file" id="import-pattern-input" accept=".txt,text/plain" hidden>
                    </section>
                </div>

                <section class="control-panel legacy-storage" aria-hidden="true">
                    <div class="pure-form storage-form">
                        <label for="filename">Filename</label>
                        <input type="text" id="filename">
                        <div class="control-row storage-actions">
                            <button id="save">Save as</button>
                            <button id="saveAsJson">Get JSON</button>
                        </div>
                        <div class="storage-row">
                            <span id="load-storage"></span>
                            <button id="delete">Delete selected</button>
                        </div>
                    </div>
                </section>
            </div>
            <div id="tracker-visual">
                <div class="transport-panel">
                    <button id="play" type="button" class="icon-btn">Play</button>
                    <button id="pause" type="button" class="icon-btn">Pause</button>
                    <button id="stop" type="button" class="icon-btn">Stop</button>
                    <button id="necklace-view-btn" type="button" class="icon-btn" title="View patterns as circles">⭘ Circle View</button>
                    <div class="transport-inline-controls">
                        <div class="tempo-control">
                            <label for="bpm">Tempo</label>
                            <div class="tempo-slider">
                                <input class="base" name="bpm" id="bpm" type="range" max="240" min="20" step="1" value="80">
                                <span id="bpmValue" aria-live="polite">80 BPM</span>
                            </div>
                        </div>
                        <div class="measure-length-controls">
                            <label for="measureLength">Measure length</label>
                            <div class="measure-length-inputs">
                                <select id="measureLengthPreset" aria-label="Quick measure length select">
                                    <option value="">Preset</option>
                                    <option value="12">12</option>
                                    <option value="16">16</option>
                                    <option value="24">24</option>
                                    <option value="32">32</option>
                                </select>
                                <input class="base" name="measureLength" id="measureLength" value="16" type="number" min="8" max="32" step="1">
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Pulse row markup is injected dynamically before drum tracks -->
                <div id="tracker-parent"></div>
                <section id="export-pattern-panel" class="export-panel inline-panel">
                    <h3>Export Pattern</h3>
                    <div class="export-pattern-content">
                        <textarea id="export-pattern-output" class="export-pattern-output" readonly aria-label="Export pattern text"></textarea>
                        <div class="export-pattern-actions">
                            <button type="button" id="export-txt-btn" class="export-btn">Download .txt</button>
                            <button type="button" id="export-midi-btn" class="export-btn">Export MIDI</button>
                            <button type="button" id="export-musicxml-btn" class="export-btn">Export MusicXML</button>
                            <button type="button" id="export-copy-btn">Copy to Clipboard</button>
                        </div>
                        <div id="export-status" class="export-status"></div>
                    </div>
                </section>
            </div>
        </div>

        <div id="advanced-panels">
            <section class="control-panel">
                <h3>Detune &amp; Envelope</h3>
                <div class="control-grid slider-grid">
                    <div class="field">
                        <label for="detune">Detune / Tune</label>
                        <input class="base" name="detune" id="detune" type="range" max="1200" min="-1200" step="10" value="0">
                    </div>

                    <div class="field checkbox-field">
                        <label class="inline-checkbox" for="gainEnabled">
                            <input class="base" name="gainEnabled" type="checkbox" id="gainEnabled" value="gain">
                            Enable gain envelope
                        </label>
                    </div>

                    <div class="field">
                        <label for="attackAmp">Attack Amp</label>
                        <input class="base" name="attackAmp" id="attackAmp" type="range" max="1" min="0" step="0.1" value="0.5">
                    </div>

                    <div class="field">
                        <label for="sustainAmp">Sustain Amp</label>
                        <input class="base" name="sustainAmp" id="sustainAmp" type="range" max="1" min="0" step="0.1" value="0.9">
                    </div>

                    <div class="field">
                        <label for="decayAmp">Decay Amp</label>
                        <input class="base" name="decayAmp" id="decayAmp" type="range" max="1" min="0" step="0.1" value="0.9">
                    </div>

                    <div class="field">
                        <label for="releaseAmp">Release Amp</label>
                        <input class="base" name="releaseAmp" id="releaseAmp" type="range" max="1" min="0" step="0.1" value="0.9">
                    </div>

                    <div class="field">
                        <label for="attackTime">Attack Time</label>
                        <input class="base" name="attackTime" id="attackTime" type="range" max="1" min="0" step="0.01" value="0.08">
                    </div>

                    <div class="field">
                        <label for="decayTime">Decay Time</label>
                        <input class="base" name="decayTime" id="decayTime" type="range" max="1" min="0" step="0.01" value="0.08">
                    </div>

                    <div class="field">
                        <label for="sustainTime">Sustain Time</label>
                        <input class="base" name="sustainTime" id="sustainTime" type="range" max="2" min="0" step="0.1" value="0.1">
                    </div>

                    <div class="field">
                        <label for="releaseTime">Release Time</label>
                        <input class="base" name="releaseTime" id="releaseTime" type="range" max="5" min="0" step="0.1" value="2">
                    </div>

                    <div class="field">
                        <label for="adsrInterval">ADSR Interval</label>
                        <input class="base" name="adsrInterval" id="adsrInterval" value="0.1" type="number" min="0" step="0.01">
                    </div>
                </div>
            </section>

            <section class="control-panel">
                <h3>Delay &amp; Filter</h3>
                <div class="control-grid slider-grid">
                    <div class="field checkbox-field">
                        <label class="inline-checkbox" for="delayEnabled">
                            <input class="base" name="delayEnabled" type="checkbox" id="delayEnabled" value="delay">
                            Enable delay
                        </label>
                    </div>

                    <div class="field">
                        <label for="delay">Delay</label>
                        <input class="base" name="delay" id="delay" type="range" max="1" min="0" step="0.01" value="0.01">
                    </div>

                    <div class="field">
                        <label for="filter">Filter</label>
                        <input class="base" name="filter" id="filter" type="range" max="10000" min="20" step="0.1" value="1000">
                    </div>
                </div>
            </section>
        </div>
    </form>
    </div>

    <!-- Euclidean Rhythm Modal -->
    <div id="euclidean-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Generate Euclidean Rhythm</h3>
            <p>Create a maximally even distribution E(k,n) over the current measure length</p>
            <div class="euclidean-inputs">
                <label>
                    Onsets (k):
                    <input type="number" id="euclidean-pulses" min="1" max="32" value="5">
                </label>
                <label>
                    Steps (n) - current measure:
                    <input type="number" id="euclidean-steps" min="1" max="32" value="16" disabled>
                </label>
            </div>
            <div class="euclidean-presets">
                <p>Common patterns:</p>
                <button type="button" class="preset-btn" data-k="3" data-n="8">E(3,8)</button>
                <button type="button" class="preset-btn" data-k="5" data-n="8">E(5,8)</button>
                <button type="button" class="preset-btn" data-k="5" data-n="12">E(5,12)</button>
                <button type="button" class="preset-btn" data-k="7" data-n="12">E(7,12)</button>
                <button type="button" class="preset-btn" data-k="5" data-n="16">E(5,16)</button>
                <button type="button" class="preset-btn" data-k="7" data-n="16">E(7,16)</button>
            </div>
            <div class="modal-actions">
                <button type="button" id="euclidean-apply">Apply</button>
                <button type="button" id="euclidean-cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Necklace/Circle View Modal -->
    <div id="necklace-modal" class="modal" style="display: none;">
        <div class="modal-content necklace-modal-content">
            <div class="necklace-header">
                <h3>Circle View</h3>
                <p>Visualize patterns as timelines on circles. Each track is shown as a necklace with onsets (filled dots) distributed around the cycle.</p>
                <button type="button" id="necklace-close" class="close-btn" aria-label="Close circle view">&times;</button>
            </div>
            <div class="necklace-canvas-container">
                <canvas id="necklace-canvas"></canvas>
            </div>
            <div class="necklace-footer">
                <p class="necklace-hint">Click the arrows (← →) beneath each circle to rotate that pattern and see how it transforms geometrically.</p>
            </div>
        </div>
    </div>

    <script src="bundle.js?t=20260125-4"></script>
    <script src="src/necklace-view.js?t=20260125-4"></script>
    <script src="script-v5.js?t=20260125-4"></script>

</body>

</html>
